---
title: "The Boons of R and Git"
subtitle: "The bountiful benefits of using R and Git for analytical work"
author: "David Sands"
date: "`r Sys.Date()`" 
output: 
  xaringan::moon_reader:
    nature:
      highlightStyle: github 
      highlightLines: true
---

<!-- Example of a comment -->

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

# Introduction

Using R and Git for your analytical work is an order of magnitude more reproducible, efficient, and _cool_ than using a twisted trinity of SQL, Excel, and Word. 

---

# Content

First I'll talk about the statistical programming language `R`, and how it can replace operations traditionally run in `SQL` and `Excel`. 

And then secondly, I will show how you can ensure your analytical work is auditable, xplanable, and reproducible with the version control software `Git`. 

---

# R 

R is class. It runs data querying, data manipulation, data presentation, and data visulisation **all in one**. 

---

# SQL Ops in R

You can pass literal `SQL` queries to R, or learn the `dplyr` suite of commands to translate SQL data querying commands in R.

```{r sql-import}
# Import needed packages
library(DBI)
library(odbc)

# In this example I'm using a DfE database I can access. 
conn1 <- dbConnect(odbc(), .connection_string = "driver={SQL Server}; server=3DCPRI-PDB16\\ACSQLS; database=KS5")

# Example of dbReadTable function from the DBI package. This reads an entire table from SQL into your R enviornment as a Data Frame
results_2017 <- DBI::dbReadTable(conn1, Id(schema = "dbo", table = "KS5_England_Results_2017"))
```

---

# SQL vs R


```{r sql-op}
# Example of standard SQL Select statement
sql_select <- DBI::dbGetQuery(conn1, "SELECT SCHNAME, TALLPUP_ACAD_1618, 
TALLPPE_ACAD_1618, TALLPPEGRD_ACAD_1618
FROM dbo.KS5_England_Results_2017
WHERE LEA = 373 -- We're selecting schools from Hilly Sheffield. Ey up!
ORDER BY TALLPPE_ACAD_1618 DESC")
```



```{r dplyr-op}
# Now here's an example of how to translate the above statement into R commands
# First, we import the dplyr package. This provides commands for the vast majority 
# of data manipulation you need to do
library(dplyr)

# Second, pull in the data you'll use. This replaces the FROM statement.
# Notice as well the below '%>%'? It is called a 'pipe'. It pipes (or chains) 
# commands together so that they can be executed at the same time. 
# To produce a pipe, type CTRL + SHIFT + M:
dplyr_select <- results_2017 %>% 
# Then replace the where statement with a filter statement:
  filter(LEA == 373) %>% arrange(desc(TALLPPE_ACAD_1618)) %>% 
# Then select the variables you want to pull through:
  select(SCHNAME, TALLPUP_ACAD_1618, TALLPPE_ACAD_1618, TALLPPEGRD_ACAD_1618)
```


---

# SQL Ops and their R translations 

```{r sql-and-r, echo=FALSE}
library(kableExtra) # renders R tables in HTML files

knitr::kable(
  data.frame(
    SQL_Statements = c(
      "Select Top 100 *",
      "Order By Col A (DESC)",
      "Group By Col A",
      "Select Function(COL A, COL B) 'New Column Name'",
      "From Table A
      Left Join Table B
      On A.Key = B.Key"
    ),
    DPLYR_Version = c(
      "top_n(100)",
      "arrange(desc(Col A))",
      "group_by(Col A)",
      "mutate(New Column Name = Function(Col A, Col B, etc))",
      "left_join(Table 1, Table B, by = 'Key')"
    )
  )
) %>% kable_styling() # renders the knitr table into the HTML file
```

---

# Excel Ops in R

`Excel` is great because it presents tabular data well. You can select, filter, and sort this data. There's an R package called `DT` that does this, but with more _chutzpah_. 

---

```{r dt-tables, echo=FALSE, tidy=FALSE}
library(DT)

dplyr_select %>% filter(TALLPUP_ACAD_1618 != 'NE') %>% mutate(TALLPUP_ACAD_1618 = as.numeric(TALLPUP_ACAD_1618)) %>% 
    mutate(TALLPPE_ACAD_1618 = as.numeric(TALLPPE_ACAD_1618)) %>% 
    mutate(TALLPPEGRD_ACAD_1618 = as.factor(TALLPPEGRD_ACAD_1618)) %>% 
  DT::datatable(fillContainer = FALSE, options = list(pageLength = 6))  
```

---

# Charts in R

You ever heard of `ggplot2`? It's class. Let me show you a few...

--

First, let's plot a histogram. 

--
And then in color

--

And then one with colors by grade

```{r ggplot-data, echo=FALSE}
# install/packages("ggplot2"")
library(ggplot2)

# Format the data for visulisation
plot_data <- dplyr_select %>% filter(TALLPUP_ACAD_1618 != 'NE') %>% mutate(TALLPUP_ACAD_1618 = as.numeric(TALLPUP_ACAD_1618)) %>% 
    mutate(TALLPPE_ACAD_1618 = as.numeric(TALLPPE_ACAD_1618)) %>% 
    mutate(TALLPPEGRD_ACAD_1618 = as.factor(TALLPPEGRD_ACAD_1618))
```

---

```{r ggplot-hist}

# Plot a histogram
ggplot2::ggplot(data = plot_data, mapping = aes(TALLPPEGRD_ACAD_1618)) + 
  geom_histogram(stat = "count")
```

---

```{r hist-color}
# Plot a histogram with colour
ggplot(data = plot_data, mapping = aes(TALLPPEGRD_ACAD_1618)) + 
  geom_histogram(stat = "count", fill = "#FF9999")
```

---

```{r hist-color-group}
# Plot a histogram with a colour per each group of the grade variable
ggplot(data = plot_data, mapping = aes(TALLPPEGRD_ACAD_1618, fill = TALLPPEGRD_ACAD_1618)) + 
  geom_histogram(stat = "count")
```

---

# Git

Latest and greatest version control system. 

---

# Working solo with Git

Committing and commit messages. 

---

# Branching out with Git

Branching and merging. Keep your folders clean and tidy with one working version of files at one point in time. 

---

# Working together with Git

Using services like `Github` and `Azure DevOps` to work together on a central set - _repository_ - of files.  

---

# How do I learn these?

If you already know SQL and Excel, read my [Coffee and Coding session on Github](https://github.com/dfe-analytical-services/coffee-and-coding/tree/master/20181121_sql-and-excel-to-r) to see how to translate those operations into R. 

And then [read this other Coffee and Coding sesh](https://github.com/dfe-analytical-services/coffee-and-coding/tree/master/20190220_gooey-git_sandsy) to understand Git, and how to do the ops (committing, branching, and merging) you will spend the majority of your time doing.

.footnote[
To read both resources, click on the link containing the word 'doanload' at the bottom of each pages, save the files, and then open the html files in your favourite browser (which **should not be** Internet Explorer). 
]

---

# Conclusion

> All their life in this world and all their adventures had only been the cover and the title page: now at last they were beginning Chapter One of the Great Story which no one on earth has read: which goes on for ever: in which every chapter is better than the one before.

.footnote[
[1] C.S. Lewis, The Last Battle
]


